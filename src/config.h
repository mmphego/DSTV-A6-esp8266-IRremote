#include <FS.h>
#include <Arduino.h>
#include <ArduinoJson.h>
#include <DNSServer.h>
#include <ESP8266HTTPUpdateServer.h>
#include <ESP8266mDNS.h>
#include <ESP8266WebServer.h>
#include <ESP8266WiFi.h>
#include <IRremoteESP8266.h>
#include <IRsend.h>
#include <PubSubClient.h>
#include <RgbIrLed.h> // get it from https://github.com/mmphego/RGB-IR-Led-ESP8266
#include <WiFiClient.h>
#include <WiFiUdp.h>
// #include <NTPClient.h>
#include <ESP8266WiFiMulti.h>
#include <WebSocketsClient.h> //  get it from https://github.com/Links2004/arduinoWebSockets/releases
#include <ArduinoJson.h> // get it from https://arduinojson.org/ or install via Arduino library manager
#include <StreamString.h>
//#include "fauxmoESP.h"

#ifndef config
#define config_h


        #define freq_strip               32 //khz
#define freq                     38 //khz
// Define physical pin
#define IRPin                    D2

// Network SetUp
#define Hostname                 "remote"
#define MySSID                   "GetUrOwnWiFi"
#define MyWifiPassword           "Livhu300312"

// Sinric /Alexa
#define MyApiKey                 "5daa356d-9e57-40c5-af70-7253918e1cb6"
#define SwitchId                 "5b2bf6ceb7999f5028aec718"
#define LightId                  "5b2e1c4277f4f95806b37152"

#define mqtt_server              "192.168.1.11"
#define mqttTopic                "/IRControl"
#define mqttTopicTV              "/IRControl/TV"
#define mqttTopicDStv            "/IRControl/DSTV"
#define mqttTopicLog             "/IRControl/Logs"

// Type LED Strip
#define LEDStrip                 0

// NTP Servers:
#define ntpServerName            "ntp1.meraka.csir.co.za"

#define JSON_BUF_SIZE            256
#define HEARTBEAT_INTERVAL       300000 // 5 Minutes



// SAMSUNG POWER ON/OFF
uint16_t Samsung_power_toggle[71] = {38000,1,1,170,170,20,63,20,63,20,63,20,20,20,20,20,
               20,20,20,20,20,20,63,20,63,20,63,20,20,20,20,20,20,
               20,20,20,20,20,20,20,63,20,20,20,20,20,20,20,20,20,
               20,20,20,20,63,20,20,20,63,20,63,20,63,20,63,20,63,
               20,63,20,1798};


typedef struct {
    //const char* remote_name;
    const int function_name;
    uint16_t code_value[68];
} IR_Code;

int num_codes = 68;
// DSTV A6
IR_Code ir_codes[68] = {
      {0, {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,500,
                                500,500,500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {1, {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,500,
                                500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,
                                500,500,500,500,500,500,500,500,500,500}
      }, {2, {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,500,
                                500,1499,500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {3, {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,500,
                                500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,
                                500,500,500,500,500,500,500,500,500,500}
      }, {4, {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,1499,
                                500,500,500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,1499,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {5, {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,1499,
                                500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,1499,500,
                                500,500,500,500,500,500,500,500,500,500}
      }, {6, {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,1499,
                                500,1499,500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,500,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {7, {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,500,500,1499,
                                500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,500,500,
                                500,500,500,500,500,500,500,500,500,500}
      }, {8, {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,1499,500,500,
                                500,500,500,500,500,1499,500,1499,500,1499,500,1499,500,500,500,1499,500,1499,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {9, {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,500,500,500,500,1499,500,500,
                                500,500,500,1499,500,1499,500,1499,500,1499,500,1499,500,500,500,1499,500,1499,500,
                                500,500,500,500,500,500,500,500,500,500}
      }, /*{POWER", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                500,500,500,500,1499,500,1499,500,1499,500,500,500,500,500,1499,500,1499,500,1499,
                                0,500,500,500,500,500,500,500,500,500,500,500}
      }, {"CATCH_UP", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                500,500,1499,500,1499,500,1499,500,1499,500,500,500,500,500,500,500,1499,500,500,
                                500,500,500,500,500,500,500,500,500,500,500}
      }, {"PLAYLIST", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                1499,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,500,500,500,500,500,
                                500,1499,500,500,500,500,500,500,500,500,500}
      }, {"BOX_OFFICE", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                1499,500,500,500,1499,500,1499,500,1499,500,500,500,500,500,500,500,500,500,1499,
                                500,500,500,500,500,500,500,500,500,500,500}
      }, {"TV_GUIDE", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                1499,500,500,500,1499,500,1499,500,1499,500,500,500,500,500,1499,500,500,500,1499,
                                500,500,500,500,500,500,500,500,500,500,500}
      }, {"SEARCH_", {7961,3981,504,504,504,1486,504,1486,504,504,504,1486,504,1486,504,1486,504,1486,
                                504,1486,504,504,504,504,504,1486,504,504,504,504,504,1486,504,1486,504,504,504,
                                504,504,1486,504,1486,504,1486,504,1486,504,504,504,504,504,1486,504,1486,504,504,
                                504,504,504,504,504,504,504,504,504,504,504}
      }, {"DSTV", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,
                                1499,500,500,500,500,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,1499,
                                500,1499,500,500,500,500,500,500,500,500,500}
      }, {"INFO", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                1499,500,1499,500,1499,500,1499,500,1499,500,500,500,500,500,1499,500,500,500,500,
                                500,500,500,500,500,500,500,500,500,500,500}
      }, {"EXIT", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                    1499,500,500,500,500,500,1499,500,1499,500,500,500,500,500,1499,500,500,500,1499,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"PROFILE", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                    500,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,1499,500,1499,500,500,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"TV", {7994,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,500,500,
                                    1499,500,1499,500,500,500,1499,500,500,500,1499,500,1499,500,1499,500,500,500,500,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"UP", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,500,500,
                                    1499,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,1499,500,500,500,500,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"DOWN", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                    1499,500,500,500,500,500,1499,500,1499,500,500,500,500,500,500,500,500,500,1499,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"LEFT", {7988,3981,504,504,504,1486,504,1486,504,504,504,1486,504,1486,504,1486,504,1486,
                                    504,1486,504,504,504,504,504,1486,504,504,504,504,504,1486,504,1486,504,1486,504,
                                    504,504,504,504,504,504,1486,504,1486,504,504,504,504,504,504,504,1486,504,1486,
                                    504,1486,504,504,504,504,504,504,504,504,504}
      }, {"RIGHT", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                    500,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,500,500,1499,500,500,
                                    500,1499,500,500,500,500,500,500,500,500,500}
      }, {"OK_BUTTON", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                    500,500,500,500,1499,500,1499,500,1499,500,500,500,500,500,500,500,1499,500,1499,
                                    500,500,500,500,500,500,500,500,500,500,500}
      }, {"OPTIONS", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,
                                    1499,500,1499,500,1499,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,500,
                                    500,500,500,500,500,500,500,500,500,500,500}
      }, {"ALT", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,500,500,1499,500,1499,500,1499,500,
                                    1499,500,1499,500,1499,500,1499,500,1499,500,500,500,500,500,500,500,500,500,500,
                                    500,500,500,500,500,500,500,500,500,500,500}
      }, {"MUTE", {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,1499,500,500,500,500,
                                    500,500,500,1499,500,1499,500,500,500,1499,500,500,500,1499,500,1499,500,1499,500,
                                    500,500,500,500,500,500,500,500,500,500}
      }, {"P_PLUS", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,500,500,1499,
                                    500,500,500,500,500,1499,500,500,500,1499,500,1499,500,1499,500,500,500,1499,500,
                                    1499,500,500,500,500,500,500,500,500,500}
      }, {"P_MINUS", {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,500,500,1499,
                                    500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,500,500,1499,500,
                                    500,500,500,500,500,500,500,500,500,500}
      }, {"VOL_PLUS", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,500,500,500,
                                    500,1499,500,500,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,500,500,500,
                                    1499,500,500,500,500,500,500,500,500,500}
      }, {"VOL_MINUS", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,500,500,500,
                                    500,1499,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,500,500,500,
                                    500,500,500,500,500,500,500,500,500,500}
      }, {"PLAY_PAUSE", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                    500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,500,
                                    500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,
                                    500,500,500,500,500,500,500,500,500,500}
      }, {"STOP", {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                              500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,500,
                              500,1499,500,1499,500,1499,500,500,500,1499,500,1499,500,500,500,1499,500,500,0,
                              500,500,500,500,500,500,500,500,500,500,500}
      }, {"RECORD", {7968,3971,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,1499,
                                500,1499,500,500,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,500,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {"REWIND", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,500,
                                500,500,500,500,500,1499,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {"FORWARD", {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,500,
                                500,1499,500,500,500,1499,500,500,500,1499,500,1499,500,500,500,1499,500,500,500,
                                1499,500,500,500,500,500,500,500,500,500}
      }, {"ARC", {7941,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                              500,1499,500,500,500,500,500,1499,500,500,500,1499,500,500,500,500,500,1499,500,1499,
                              500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,500,500,500,500,1499,500,
                              500,500,500,500,500,500,500,500,500,500}
      }, {"HELP", {7968,3997,500,500,500,1499,500,1499,500,500,500,1499,500,1499,500,1499,500,1499,
                                500,1499,500,500,500,500,500,1499,500,500,500,1499,500,1499,500,1499,500,500,500,1499,
                                500,1499,500,1499,500,1499,500,500,500,500,500,500,500,1499,500,500,500,500,500,
                                500,500,500,500,500,500,500,500,500,500}
      }*/
    };


// NETWORK: Static IP details...
IPAddress ip(192, 168, 1, 54);
IPAddress gateway(192, 168, 1, 1);
IPAddress dns(192, 168, 1, 1);
IPAddress subnet(255, 255, 255, 0);
IPAddress broadcast(192, 168, 1, 255); // Broadcast IP address

char receivedChar[100];
bool running = false;
bool stopped = true;
char msg[50];
char message[65];

const int timeZone = 2; // Jozi Time
unsigned int localPort = 8888;  // local port to listen for UDP packets
uint64_t heartbeatTimestamp = 0;
bool isConnected = false;

// WOL CONFIGURATION
byte kodi_server_mac[] = {0xee, 0xb7, 0xb8, 0x74, 0x0c, 0xc6};  // PC's MAC address
char text ;
#endif
